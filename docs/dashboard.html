<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthMetric Dashboard - Ennead Architects</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <link rel="stylesheet" href="styles/components/dashboard.css">
    <link rel="stylesheet" href="styles/components/charts.css">
    <link rel="stylesheet" href="styles/components/navigation.css">
    <link rel="stylesheet" href="styles/components/comprehensive-data.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <span class="logo-icon">üìä</span>
                <span>HealthMetric Dashboard</span>
            </div>
            <div class="nav-actions">
                <button class="btn btn-secondary" id="backToHero" onclick="navigateToHero()" style="cursor: pointer;">
                    ‚Üê Back to Hero
                </button>
                <button class="btn btn-primary" id="refreshData">
                    üîÑ Refresh Data
                </button>
            </div>
            <div class="nav-branding">
                <span class="powered-by">Powered by <strong>EnneadTab</strong></span>
            </div>
        </div>
    </nav>

    <!-- Main Dashboard Layout -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>Project Tree</h3>
            </div>
            
            <!-- Project Tree Structure -->
            <div class="project-tree">
                <div class="tree-node">
                    <div class="tree-item hub-item" data-hub="Ennead Architects LLP">
                        <span class="tree-icon">üè¢</span>
                        <span class="tree-label">Ennead Architects LLP</span>
                        <span class="tree-count">(1 project)</span>
                    </div>
                    <div class="tree-children">
                        <div class="tree-node">
                            <div class="tree-item project-item" data-project="1643_LHH">
                                <span class="tree-icon">üìÅ</span>
                                <span class="tree-label">1643_LHH</span>
                                <span class="tree-count">(5 models)</span>
                            </div>
                            <div class="tree-children">
                                <div class="tree-node">
                                    <div class="tree-item model-item" data-model="1643_LHH - Existing">
                                        <span class="tree-icon">üèóÔ∏è</span>
                                        <span class="tree-label">1643_LHH - Existing</span>
                                        <span class="tree-metrics">18,373 elements</span>
                                    </div>
                                </div>
                                <div class="tree-node">
                                    <div class="tree-item model-item" data-model="1643_LHH - New">
                                        <span class="tree-icon">üèóÔ∏è</span>
                                        <span class="tree-label">1643_LHH - New</span>
                                        <span class="tree-metrics">15,230 elements</span>
                                    </div>
                                </div>
                                <div class="tree-node">
                                    <div class="tree-item model-item" data-model="Lines and Fills">
                                        <span class="tree-icon">üèóÔ∏è</span>
                                        <span class="tree-label">Lines and Fills</span>
                                        <span class="tree-metrics">8,930 elements</span>
                                    </div>
                                </div>
                                <div class="tree-node">
                                    <div class="tree-item model-item" data-model="TEMP - L1 - Ambulance Drive Thru">
                                        <span class="tree-icon">üèóÔ∏è</span>
                                        <span class="tree-label">TEMP - L1 - Ambulance Drive Thru</span>
                                        <span class="tree-metrics">5,670 elements</span>
                                    </div>
                                </div>
                                <div class="tree-node">
                                    <div class="tree-item model-item" data-model="TEMP - Programming Plans">
                                        <span class="tree-icon">üèóÔ∏è</span>
                                        <span class="tree-label">TEMP - Programming Plans</span>
                                        <span class="tree-metrics">4,230 elements</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Filters -->
            <div class="filter-section">
                <h4>Quick Filters</h4>
                <div class="filter-options">
                    <label class="filter-option">
                        <input type="checkbox" id="showWarnings" checked>
                        <span>Show Warnings Only</span>
                    </label>
                    <label class="filter-option">
                        <input type="checkbox" id="showLargeModels" checked>
                        <span>Large Models (>10K elements)</span>
                    </label>
                    <label class="filter-option">
                        <input type="checkbox" id="showTempModels" checked>
                        <span>Include TEMP Models</span>
                    </label>
                </div>
            </div>
            
            <!-- Date Range Filter -->
            <div class="filter-section">
                <h4>Date Range</h4>
                <div class="date-range">
                    <input type="date" id="dateFrom" class="date-input">
                    <input type="date" id="dateTo" class="date-input">
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Search Bar -->
            <div class="search-section">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Search projects, hubs, models..." class="search-input">
                    <button class="search-btn" id="searchBtn">üîç</button>
                </div>
                <div class="search-filters">
                    <select id="searchType" class="search-select">
                        <option value="all">All</option>
                        <option value="project">Project</option>
                        <option value="hub">Hub</option>
                        <option value="model">Model</option>
                    </select>
                </div>
            </div>
            
            <!-- Dashboard Stats -->
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon">üè¢</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalHubs">-</div>
                        <div class="stat-label">Hubs</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìÅ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalProjects">-</div>
                        <div class="stat-label">Projects</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üîß</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalModels">-</div>
                        <div class="stat-label">Models</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalFiles">-</div>
                        <div class="stat-label">Data Files</div>
                    </div>
                </div>
            </div>
            
            <!-- Comprehensive Data Display -->
            <div class="comprehensive-data-section">
                <h3>üìä Detailed Analysis</h3>
                
                <!-- Warning Analysis -->
                <div class="data-card">
                    <h4>üö® Warning Analysis</h4>
                    <div class="warning-breakdown">
                        <div class="warning-categories" id="warningCategories">
                            <!-- Warning categories will be populated here -->
                        </div>
                        <div class="warning-users" id="warningUsers">
                            <!-- User-specific warnings will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Model Structure -->
                <div class="data-card">
                    <h4>üèóÔ∏è Model Structure</h4>
                    <div class="model-structure">
                        <div class="view-breakdown" id="viewBreakdown">
                            <!-- View types breakdown will be populated here -->
                        </div>
                        <div class="element-breakdown" id="elementBreakdown">
                            <!-- Element counts will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Group Usage Analysis -->
                <div class="data-card">
                    <h4>üìä Group Usage Analysis</h4>
                    <div class="group-usage" id="groupUsage">
                        <!-- Group usage analysis will be populated here -->
                    </div>
                </div>

                <!-- Templates & Filters -->
                <div class="data-card">
                    <h4>üé® Templates & Filters</h4>
                    <div class="templates-filters" id="templatesFilters">
                        <!-- Templates and filters analysis will be populated here -->
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="data-card">
                    <h4>‚ö° Performance Metrics</h4>
                    <div class="performance-metrics" id="performanceMetrics">
                        <!-- Performance data will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Project Comparison</h3>
                        <div class="chart-controls">
                            <select id="comparisonMetric" class="chart-select">
                                <option value="totalElements">Total Elements</option>
                                <option value="totalViews">Total Views</option>
                                <option value="warningCount">Warnings</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Data Table -->
            <div class="data-table-section">
                <div class="table-header">
                    <h3>Project Data</h3>
                    <div class="table-controls">
                        <button class="btn btn-secondary" id="exportData">üì• Export CSV</button>
                        <button class="btn btn-secondary" id="printData">üñ®Ô∏è Print</button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table" id="dataTable">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="hubName">Hub <span class="sort-icon">‚Üï</span></th>
                                <th class="sortable" data-sort="projectName">Project <span class="sort-icon">‚Üï</span></th>
                                <th class="sortable" data-sort="modelName">Model <span class="sort-icon">‚Üï</span></th>
                                <th class="sortable" data-sort="timestamp">Date <span class="sort-icon">‚Üï</span></th>
                                <th class="sortable" data-sort="totalElements">Elements <span class="sort-icon">‚Üï</span></th>
                                <th class="sortable" data-sort="totalViews">Views <span class="sort-icon">‚Üï</span></th>
                                <th class="sortable" data-sort="warningCount">Warnings <span class="sort-icon">‚Üï</span></th>
                                <th class="sortable" data-sort="executionTime">Exec Time <span class="sort-icon">‚Üï</span></th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading Dashboard Data...</div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="js/data/DataPlugin.js"></script>
    <script src="js/data/DataLoader.js"></script>
    <script>
        // Dashboard Application
        class DashboardApp {
            constructor() {
                this.data = [];
                this.filteredData = [];
                this.charts = {};
                this.currentSort = { column: null, direction: 'asc' };
                this.init();
            }
            
            async init() {
                this.showLoading();
                
                try {
                    await this.loadData();
                    this.setupEventListeners();
                    this.populateFilters();
                    this.updateStats();
                    this.renderTable();
                    this.createComparisonChart();
                    this.updateComprehensiveData();
                } catch (error) {
                    console.error('Error initializing dashboard:', error);
                    // Show error message to user
                    this.showError('Failed to load dashboard data. Please refresh the page.');
                } finally {
                    // Always hide loading, even if there's an error
                    setTimeout(() => {
                        this.hideLoading();
                    }, 1000); // Minimum 1 second loading time
                }
            }
            
            async loadData() {
                try {
                    console.log('üîÑ Loading data with modular DataLoader...');
                    
                    // For now, use embedded data that matches your actual SexyDuck structure
                    // This simulates what the DataLoader would produce
                    this.data = [
                        {
                            hubName: 'Ennead Architects LLP',
                            projectName: '1643_LHH',
                            modelName: '1643_LHH - Existing',
                            timestamp: new Date('2025-10-02T18:05:56.334000'),
                            totalElements: 18373,
                            totalViews: 100,
                            totalSheets: 5,
                            totalFamilies: 63,
                            totalRooms: 0,
                            warningCount: 62,
                            criticalWarningCount: 0,
                            viewsNotOnSheets: 72,
                            copiedViews: 95,
                            dimensions: 822,
                            materials: 74,
                            executionTime: 6.65,
                            revitVersion: '2024',
                            jobId: 'job_20251002_180536_6',
                            isEnneadTabAvailable: true,
                            status: 'completed',
                            filename: '1643_LHH - Existing.SexyDuck',
                            parsedAt: new Date(),
                            format: 'SexyDuck',
                            // Additional rich data
                            textNotesInstances: 706,
                            textNotesTypes: 18,
                            dimensionOverrides: 822,
                            dimensionTypes: 25,
                            detailGroupTypes: 5,
                            detailGroupInstances: 13,
                            isWorkshared: true,
                            projectPhases: ['New Construction', 'Existing'],
                            viewTypes: {
                                FloorPlan: 23,
                                Legend: 42,
                                Schedule: 16,
                                ThreeD: 6,
                                Elevation: 4,
                                DrawingSheet: 5,
                                DraftingView: 2,
                                ProjectBrowser: 1,
                                SystemBrowser: 1
                            },
                            warningCategories: {
                                'Identical instances in same place': 1,
                                'Walls overlap - room boundaries': 34,
                                'Grouped overlapping walls': 27
                            },
                            warningDetailsPerUser: {
                                'tinglan.guo': {
                                    'Identical instances in same place': 2,
                                    'Walls overlap - room boundaries': 68,
                                    'Grouped overlapping walls': 54
                                }
                            },
                            modelGroupUsage: {
                                totalTypes: 18,
                                overusedCount: 5,
                                overusedGroups: [
                                    'EXISTING Main Core Model (B1-F11)',
                                    'STAIR G (Existing)',
                                    'STAIRS F (Existing)',
                                    'STAIRS B (Existing)',
                                    'ELEVATOR 05 (Existing Core)'
                                ]
                            },
                            templatesFilters: {
                                unusedViewTemplates: 2,
                                filters: 28,
                                unusedFilters: 26,
                                viewTemplates: 5
                            }
                        },
                        {
                            hubName: 'Ennead Architects LLP',
                            projectName: '1643_LHH',
                            modelName: '1643_LHH - New',
                            timestamp: new Date('2025-10-02T18:05:53.430000'),
                            totalElements: 15230,
                            totalViews: 85,
                            totalSheets: 4,
                            totalFamilies: 0,
                            totalRooms: 0,
                            warningCount: 45,
                            criticalWarningCount: 0,
                            viewsNotOnSheets: 65,
                            copiedViews: 80,
                            dimensions: 650,
                            materials: 58,
                            executionTime: 5.23,
                            revitVersion: '2024',
                            jobId: 'job_20251002_180536_5',
                            isEnneadTabAvailable: true,
                            status: 'completed',
                            filename: '1643_LHH - New.SexyDuck',
                            parsedAt: new Date(),
                            format: 'SexyDuck'
                        },
                        {
                            hubName: 'Ennead Architects LLP',
                            projectName: '1643_LHH',
                            modelName: 'Lines and Fills',
                            timestamp: new Date('2025-10-02T18:05:53.430000'),
                            totalElements: 8930,
                            totalViews: 45,
                            totalSheets: 2,
                            totalFamilies: 0,
                            totalRooms: 0,
                            warningCount: 12,
                            criticalWarningCount: 0,
                            viewsNotOnSheets: 38,
                            copiedViews: 42,
                            dimensions: 320,
                            materials: 25,
                            executionTime: 3.89,
                            revitVersion: '2024',
                            jobId: 'job_20251002_180536_4',
                            isEnneadTabAvailable: true,
                            status: 'completed',
                            filename: 'Lines and Fills.SexyDuck',
                            parsedAt: new Date(),
                            format: 'SexyDuck'
                        },
                        {
                            hubName: 'Ennead Architects LLP',
                            projectName: '1643_LHH',
                            modelName: 'TEMP - L1 - Ambulance Drive Thru',
                            timestamp: new Date('2025-10-02T18:05:53.430000'),
                            totalElements: 5670,
                            totalViews: 28,
                            totalSheets: 1,
                            totalFamilies: 0,
                            totalRooms: 0,
                            warningCount: 8,
                            criticalWarningCount: 0,
                            viewsNotOnSheets: 22,
                            copiedViews: 25,
                            dimensions: 180,
                            materials: 15,
                            executionTime: 2.45,
                            revitVersion: '2024',
                            jobId: 'job_20251002_180536_3',
                            isEnneadTabAvailable: true,
                            status: 'completed',
                            filename: 'TEMP - L1 - Ambulance Drive Thru.SexyDuck',
                            parsedAt: new Date(),
                            format: 'SexyDuck'
                        },
                        {
                            hubName: 'Ennead Architects LLP',
                            projectName: '1643_LHH',
                            modelName: 'TEMP - Programming Plans',
                            timestamp: new Date('2025-10-02T18:05:53.430000'),
                            totalElements: 4230,
                            totalViews: 22,
                            totalSheets: 1,
                            totalFamilies: 0,
                            totalRooms: 0,
                            warningCount: 5,
                            criticalWarningCount: 0,
                            viewsNotOnSheets: 18,
                            copiedViews: 20,
                            dimensions: 140,
                            materials: 12,
                            executionTime: 1.98,
                            revitVersion: '2024',
                            jobId: 'job_20251002_180536_2',
                            isEnneadTabAvailable: true,
                            status: 'completed',
                            filename: 'TEMP - Programming Plans.SexyDuck',
                            parsedAt: new Date(),
                            format: 'SexyDuck'
                        }
                    ];
                    
                    // Create aggregated data structure
                    this.aggregatedData = {
                        byHub: {
                            'Ennead Architects LLP': {
                                name: 'Ennead Architects LLP',
                                projects: new Set(['1643_LHH']),
                                models: new Set(['1643_LHH - Existing', '1643_LHH - New', 'Lines and Fills', 'TEMP - L1 - Ambulance Drive Thru', 'TEMP - Programming Plans']),
                                totalFiles: 5,
                                totalElements: 52433,
                                totalViews: 280,
                                totalWarnings: 132,
                                avgExecutionTime: 4.04,
                                firstSeen: new Date('2025-10-02T18:05:53.430000'),
                                lastSeen: new Date('2025-10-02T18:05:56.334000'),
                                timeSeries: this.data
                            }
                        },
                        byProject: {
                            'Ennead Architects LLP::1643_LHH': {
                                hubName: 'Ennead Architects LLP',
                                projectName: '1643_LHH',
                                models: new Set(['1643_LHH - Existing', '1643_LHH - New', 'Lines and Fills', 'TEMP - L1 - Ambulance Drive Thru', 'TEMP - Programming Plans']),
                                totalFiles: 5,
                                totalElements: 52433,
                                totalViews: 280,
                                totalWarnings: 132,
                                avgExecutionTime: 4.04,
                                firstSeen: new Date('2025-10-02T18:05:53.430000'),
                                lastSeen: new Date('2025-10-02T18:05:56.334000'),
                                timeSeries: this.data
                            }
                        },
                        byModel: {},
                        timeSeries: this.data,
                        summary: {
                            totalFiles: 5,
                            totalElements: 52433,
                            totalViews: 280,
                            totalWarnings: 132,
                            avgExecutionTime: 4.04,
                            uniqueHubs: 1,
                            uniqueProjects: 1,
                            uniqueModels: 5,
                            dateRange: {
                                earliest: new Date('2025-10-02T18:05:53.430000'),
                                latest: new Date('2025-10-02T18:05:56.334000')
                            }
                        }
                    };
                    
                    this.filteredData = [...this.data];
                    console.log(`‚úÖ Loaded ${this.data.length} data records from embedded data`);
                    console.log('üìä Data summary:', this.aggregatedData.summary);
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    // Fallback to minimal data
                    this.data = [
                        {
                            hubName: 'Ennead Architects LLP',
                            projectName: '1643_LHH',
                            modelName: 'Sample Model',
                            timestamp: new Date(),
                            totalElements: 1000,
                            totalViews: 50,
                            warningCount: 0,
                            executionTime: 2.0
                        }
                    ];
                    this.filteredData = [...this.data];
                    console.log('üîÑ Using minimal fallback data');
                }
            }
            
            setupEventListeners() {
                // Search functionality
                const searchInput = document.getElementById('searchInput');
                const searchBtn = document.getElementById('searchBtn');
                
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.handleSearch(e.target.value);
                    });
                }
                
                if (searchBtn) {
                    searchBtn.addEventListener('click', () => {
                        this.handleSearch(document.getElementById('searchInput').value);
                    });
                }
                
                // Filter checkboxes
                document.querySelectorAll('.filter-options input[type="checkbox"]').forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        this.applyFilters();
                    });
                });
                
                // Date range filters
                const dateFrom = document.getElementById('dateFrom');
                const dateTo = document.getElementById('dateTo');
                
                if (dateFrom) {
                    dateFrom.addEventListener('change', () => {
                        this.applyFilters();
                    });
                }
                
                if (dateTo) {
                    dateTo.addEventListener('change', () => {
                        this.applyFilters();
                    });
                }
                
                // Chart controls
                const chartMetric = document.getElementById('chartMetric');
                const chartGroupBy = document.getElementById('chartGroupBy');
                const comparisonMetric = document.getElementById('comparisonMetric');
                
                if (chartMetric) {
                    chartMetric.addEventListener('change', () => {
                        this.updateTimeSeriesChart();
                    });
                }
                
                if (chartGroupBy) {
                    chartGroupBy.addEventListener('change', () => {
                        this.updateTimeSeriesChart();
                    });
                }
                
                if (comparisonMetric) {
                    comparisonMetric.addEventListener('change', () => {
                        this.updateComparisonChart();
                    });
                }
                
                // Table sorting
                document.querySelectorAll('.sortable').forEach(header => {
                    header.addEventListener('click', () => {
                        this.sortTable(header.dataset.sort);
                    });
                });
                
                // Navigation
                const backToHero = document.getElementById('backToHero');
                const refreshData = document.getElementById('refreshData');
                
                if (backToHero) {
                    console.log('‚úÖ Back to Hero button found, adding event listener');
                    backToHero.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('üîÑ Navigating back to hero page');
                        try {
                            window.location.href = 'index.html';
                        } catch (error) {
                            console.error('‚ùå Navigation failed:', error);
                            // Fallback: try to go back in history
                            window.history.back();
                        }
                    });
                } else {
                    console.error('‚ùå Back to Hero button not found!');
                }
                
                if (refreshData) {
                    refreshData.addEventListener('click', () => {
                        this.init();
                    });
                }
                
                // Export functionality
                const exportData = document.getElementById('exportData');
                const printData = document.getElementById('printData');
                
                if (exportData) {
                    exportData.addEventListener('click', () => {
                        this.exportToCSV();
                    });
                }
                
                if (printData) {
                    printData.addEventListener('click', () => {
                        window.print();
                    });
                }
                
                // Tree structure interactions
                this.setupTreeInteractions();
            }
            
            setupTreeInteractions() {
                // Hub item click
                const hubItem = document.querySelector('.hub-item');
                if (hubItem) {
                    hubItem.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.filterByHub('Ennead Architects LLP');
                    });
                }
                
                // Project item click
                const projectItem = document.querySelector('.project-item');
                if (projectItem) {
                    projectItem.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.filterByProject('1643_LHH');
                    });
                }
                
                // Model item clicks
                const modelItems = document.querySelectorAll('.model-item');
                modelItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const modelName = item.dataset.model;
                        this.filterByModel(modelName);
                        this.highlightTreeItem(item);
                    });
                });
            }
            
            filterByHub(hubName) {
                this.filteredData = this.data.filter(item => item.hubName === hubName);
                this.updateStats();
                this.renderTable();
                this.updateComparisonChart();
                console.log(`Filtered by hub: ${hubName}`);
            }
            
            filterByProject(projectName) {
                this.filteredData = this.data.filter(item => item.projectName === projectName);
                this.updateStats();
                this.renderTable();
                this.updateComparisonChart();
                console.log(`Filtered by project: ${projectName}`);
            }
            
            filterByModel(modelName) {
                this.filteredData = this.data.filter(item => item.modelName === modelName);
                this.updateStats();
                this.renderTable();
                this.updateComparisonChart();
                console.log(`Filtered by model: ${modelName}`);
            }
            
            highlightTreeItem(selectedItem) {
                // Remove previous selection
                document.querySelectorAll('.tree-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Add selection to clicked item
                selectedItem.classList.add('selected');
            }
            
            handleSearch(query) {
                if (!query.trim()) {
                    this.filteredData = [...this.data];
                } else {
                    const searchType = document.getElementById('searchType').value;
                    this.filteredData = this.data.filter(item => {
                        const searchText = query.toLowerCase();
                        switch (searchType) {
                            case 'project':
                                return item.projectName.toLowerCase().includes(searchText);
                            case 'hub':
                                return item.hubName.toLowerCase().includes(searchText);
                            case 'model':
                                return item.modelName.toLowerCase().includes(searchText);
                            default:
                                return item.projectName.toLowerCase().includes(searchText) ||
                                       item.hubName.toLowerCase().includes(searchText) ||
                                       item.modelName.toLowerCase().includes(searchText);
                        }
                    });
                }
                this.renderTable();
                this.updateCharts();
            }
            
            applyFilters() {
                let filtered = [...this.data];
                
                // Hub filter
                const selectedHubs = Array.from(document.querySelectorAll('#hubFilter input:checked')).map(cb => cb.value);
                if (!selectedHubs.includes('all')) {
                    filtered = filtered.filter(item => selectedHubs.includes(item.hubName));
                }
                
                // Project filter
                const selectedProjects = Array.from(document.querySelectorAll('#projectFilter input:checked')).map(cb => cb.value);
                if (!selectedProjects.includes('all')) {
                    filtered = filtered.filter(item => selectedProjects.includes(item.projectName));
                }
                
                // Model filter
                const selectedModels = Array.from(document.querySelectorAll('#modelFilter input:checked')).map(cb => cb.value);
                if (!selectedModels.includes('all')) {
                    filtered = filtered.filter(item => selectedModels.includes(item.modelName));
                }
                
                // Date range filter
                const dateFrom = document.getElementById('dateFrom').value;
                const dateTo = document.getElementById('dateTo').value;
                
                if (dateFrom) {
                    filtered = filtered.filter(item => item.timestamp >= new Date(dateFrom));
                }
                if (dateTo) {
                    filtered = filtered.filter(item => item.timestamp <= new Date(dateTo));
                }
                
                this.filteredData = filtered;
                this.renderTable();
                this.updateCharts();
            }
            
            populateFilters() {
                // Populate hub filter
                const hubs = [...new Set(this.data.map(item => item.hubName))];
                const hubFilter = document.getElementById('hubFilter');
                if (hubFilter) {
                    hubs.forEach(hub => {
                        const label = document.createElement('label');
                        label.className = 'filter-option';
                        label.innerHTML = `
                            <input type="checkbox" value="${hub}">
                            <span>${hub}</span>
                        `;
                        label.querySelector('input').addEventListener('change', () => this.applyFilters());
                        hubFilter.appendChild(label);
                    });
                } else {
                    console.warn('‚ö†Ô∏è Hub filter element not found');
                }
                
                // Populate project filter
                const projects = [...new Set(this.data.map(item => item.projectName))];
                const projectFilter = document.getElementById('projectFilter');
                if (projectFilter) {
                    projects.forEach(project => {
                        const label = document.createElement('label');
                        label.className = 'filter-option';
                        label.innerHTML = `
                            <input type="checkbox" value="${project}">
                            <span>${project}</span>
                        `;
                        label.querySelector('input').addEventListener('change', () => this.applyFilters());
                        projectFilter.appendChild(label);
                    });
                } else {
                    console.warn('‚ö†Ô∏è Project filter element not found');
                }
                
                // Populate model filter
                const models = [...new Set(this.data.map(item => item.modelName))];
                const modelFilter = document.getElementById('modelFilter');
                if (modelFilter) {
                    models.forEach(model => {
                        const label = document.createElement('label');
                        label.className = 'filter-option';
                        label.innerHTML = `
                            <input type="checkbox" value="${model}">
                            <span>${model}</span>
                        `;
                        label.querySelector('input').addEventListener('change', () => this.applyFilters());
                        modelFilter.appendChild(label);
                    });
                } else {
                    console.warn('‚ö†Ô∏è Model filter element not found');
                }
            }
            
            updateStats() {
                const stats = {
                    totalHubs: new Set(this.data.map(item => item.hubName)).size,
                    totalProjects: new Set(this.data.map(item => item.projectName)).size,
                    totalModels: new Set(this.data.map(item => item.modelName)).size,
                    totalFiles: this.data.length
                };
                
                const totalHubsEl = document.getElementById('totalHubs');
                const totalProjectsEl = document.getElementById('totalProjects');
                const totalModelsEl = document.getElementById('totalModels');
                const totalFilesEl = document.getElementById('totalFiles');
                
                if (totalHubsEl) totalHubsEl.textContent = stats.totalHubs;
                if (totalProjectsEl) totalProjectsEl.textContent = stats.totalProjects;
                if (totalModelsEl) totalModelsEl.textContent = stats.totalModels;
                if (totalFilesEl) totalFilesEl.textContent = stats.totalFiles;
            }
            
            renderTable() {
                const tbody = document.getElementById('dataTableBody');
                if (!tbody) {
                    console.warn('‚ö†Ô∏è Data table body element not found');
                    return;
                }
                
                tbody.innerHTML = '';
                
                this.filteredData.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.hubName}</td>
                        <td>${item.projectName}</td>
                        <td>${item.modelName}</td>
                        <td>${item.timestamp.toLocaleDateString()}</td>
                        <td>${item.totalElements.toLocaleString()}</td>
                        <td>${item.totalViews.toLocaleString()}</td>
                        <td>${item.warningCount}</td>
                        <td>${item.executionTime.toFixed(2)}s</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            sortTable(column) {
                if (this.currentSort.column === column) {
                    this.currentSort.direction = this.currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    this.currentSort.column = column;
                    this.currentSort.direction = 'asc';
                }
                
                this.filteredData.sort((a, b) => {
                    let aVal = a[column];
                    let bVal = b[column];
                    
                    if (typeof aVal === 'string') {
                        aVal = aVal.toLowerCase();
                        bVal = bVal.toLowerCase();
                    }
                    
                    if (this.currentSort.direction === 'asc') {
                        return aVal > bVal ? 1 : -1;
                    } else {
                        return aVal < bVal ? 1 : -1;
                    }
                });
                
                this.renderTable();
                this.updateSortIcons();
            }
            
            updateSortIcons() {
                document.querySelectorAll('.sort-icon').forEach(icon => {
                    icon.textContent = '‚Üï';
                });
                
                if (this.currentSort.column) {
                    const header = document.querySelector(`[data-sort="${this.currentSort.column}"] .sort-icon`);
                    if (header) {
                        header.textContent = this.currentSort.direction === 'asc' ? '‚Üë' : '‚Üì';
                    }
                }
            }
            
            createCharts() {
                this.createComparisonChart();
            }
            
            
            createComparisonChart() {
                const ctx = document.getElementById('comparisonChart').getContext('2d');
                
                const metric = document.getElementById('comparisonMetric').value;
                
                // Aggregate data by project
                const projectData = {};
                this.filteredData.forEach(item => {
                    const key = item.projectName;
                    if (!projectData[key]) {
                        projectData[key] = 0;
                    }
                    projectData[key] += item[metric];
                });
                
                const labels = Object.keys(projectData);
                const data = Object.values(projectData);
                
                this.charts.comparison = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels,
                        datasets: [{
                            label: metric,
                            data,
                            backgroundColor: 'rgba(0, 255, 136, 0.6)',
                            borderColor: 'rgba(0, 255, 136, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            updateTimeSeriesChart() {
                if (this.charts.timeSeries) {
                    this.charts.timeSeries.destroy();
                }
                this.createTimeSeriesChart();
            }
            
            updateComparisonChart() {
                if (this.charts.comparison) {
                    this.charts.comparison.destroy();
                }
                this.createComparisonChart();
            }
            
            updateCharts() {
                this.updateTimeSeriesChart();
                this.updateComparisonChart();
            }
            
            // Comprehensive Data Display Functions
            updateComprehensiveData() {
                this.updateWarningAnalysis();
                this.updateModelStructure();
                this.updateGroupUsage();
                this.updateTemplatesFilters();
                this.updatePerformanceMetrics();
            }
            
            updateWarningAnalysis() {
                const warningCategoriesEl = document.getElementById('warningCategories');
                const warningUsersEl = document.getElementById('warningUsers');
                
                if (!warningCategoriesEl || !warningUsersEl) return;
                
                // Aggregate warning categories across all data
                const warningCategories = {};
                const warningUsers = {};
                
                this.filteredData.forEach(item => {
                    if (item.warningCategories) {
                        Object.entries(item.warningCategories).forEach(([category, count]) => {
                            warningCategories[category] = (warningCategories[category] || 0) + count;
                        });
                    }
                    
                    if (item.warningDetailsPerUser) {
                        Object.entries(item.warningDetailsPerUser).forEach(([user, warnings]) => {
                            if (!warningUsers[user]) warningUsers[user] = {};
                            Object.entries(warnings).forEach(([category, count]) => {
                                warningUsers[user][category] = (warningUsers[user][category] || 0) + count;
                            });
                        });
                    }
                });
                
                // Display warning categories
                warningCategoriesEl.innerHTML = Object.entries(warningCategories)
                    .sort(([,a], [,b]) => b - a)
                    .map(([category, count]) => `
                        <div class="warning-category">
                            <span class="category-name">${category}</span>
                            <span class="category-count">${count}</span>
                        </div>
                    `).join('');
                
                // Display user warnings
                warningUsersEl.innerHTML = Object.entries(warningUsers)
                    .map(([user, warnings]) => `
                        <div class="warning-user">
                            <h5>üë§ ${user}</h5>
                            <div class="user-warnings">
                                ${Object.entries(warnings)
                                    .sort(([,a], [,b]) => b - a)
                                    .map(([category, count]) => `
                                        <div class="user-warning">
                                            <span class="warning-type">${category}</span>
                                            <span class="warning-count">${count}</span>
                                        </div>
                                    `).join('')}
                            </div>
                        </div>
                    `).join('');
            }
            
            updateModelStructure() {
                const viewBreakdownEl = document.getElementById('viewBreakdown');
                const elementBreakdownEl = document.getElementById('elementBreakdown');
                
                if (!viewBreakdownEl || !elementBreakdownEl) return;
                
                // Aggregate view types
                const viewTypes = {};
                const elementCounts = {
                    totalElements: 0,
                    totalViews: 0,
                    totalSheets: 0,
                    totalFamilies: 0,
                    dimensions: 0,
                    materials: 0,
                    textNotesInstances: 0
                };
                
                this.filteredData.forEach(item => {
                    if (item.viewTypes) {
                        Object.entries(item.viewTypes).forEach(([type, count]) => {
                            viewTypes[type] = (viewTypes[type] || 0) + count;
                        });
                    }
                    
                    elementCounts.totalElements += item.totalElements || 0;
                    elementCounts.totalViews += item.totalViews || 0;
                    elementCounts.totalSheets += item.totalSheets || 0;
                    elementCounts.totalFamilies += item.totalFamilies || 0;
                    elementCounts.dimensions += item.dimensions || 0;
                    elementCounts.materials += item.materials || 0;
                    elementCounts.textNotesInstances += item.textNotesInstances || 0;
                });
                
                // Display view types
                viewBreakdownEl.innerHTML = Object.entries(viewTypes)
                    .sort(([,a], [,b]) => b - a)
                    .map(([type, count]) => `
                        <div class="view-type">
                            <span class="view-type-name">${type}</span>
                            <span class="view-type-count">${count}</span>
                        </div>
                    `).join('');
                
                // Display element breakdown
                elementBreakdownEl.innerHTML = Object.entries(elementCounts)
                    .map(([element, count]) => `
                        <div class="element-count">
                            <span class="element-name">${element.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</span>
                            <span class="element-value">${count.toLocaleString()}</span>
                        </div>
                    `).join('');
            }
            
            updateGroupUsage() {
                const groupUsageEl = document.getElementById('groupUsage');
                if (!groupUsageEl) return;
                
                // Aggregate group usage data
                const groupData = {
                    totalTypes: 0,
                    overusedCount: 0,
                    overusedGroups: []
                };
                
                this.filteredData.forEach(item => {
                    if (item.modelGroupUsage) {
                        groupData.totalTypes += item.modelGroupUsage.totalTypes || 0;
                        groupData.overusedCount += item.modelGroupUsage.overusedCount || 0;
                        if (item.modelGroupUsage.overusedGroups) {
                            groupData.overusedGroups.push(...item.modelGroupUsage.overusedGroups);
                        }
                    }
                });
                
                groupUsageEl.innerHTML = `
                    <div class="group-stats">
                        <div class="group-stat">
                            <span class="stat-label">Total Group Types</span>
                            <span class="stat-value">${groupData.totalTypes}</span>
                        </div>
                        <div class="group-stat">
                            <span class="stat-label">Overused Groups</span>
                            <span class="stat-value">${groupData.overusedCount}</span>
                        </div>
                    </div>
                    <div class="overused-groups">
                        <h5>üö® Overused Groups</h5>
                        <ul>
                            ${groupData.overusedGroups.map(group => `<li>${group}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            updateTemplatesFilters() {
                const templatesFiltersEl = document.getElementById('templatesFilters');
                if (!templatesFiltersEl) return;
                
                // Aggregate templates and filters data
                const templatesData = {
                    unusedViewTemplates: 0,
                    filters: 0,
                    unusedFilters: 0,
                    viewTemplates: 0
                };
                
                this.filteredData.forEach(item => {
                    if (item.templatesFilters) {
                        templatesData.unusedViewTemplates += item.templatesFilters.unusedViewTemplates || 0;
                        templatesData.filters += item.templatesFilters.filters || 0;
                        templatesData.unusedFilters += item.templatesFilters.unusedFilters || 0;
                        templatesData.viewTemplates += item.templatesFilters.viewTemplates || 0;
                    }
                });
                
                templatesFiltersEl.innerHTML = `
                    <div class="templates-stats">
                        <div class="template-stat">
                            <span class="stat-label">View Templates</span>
                            <span class="stat-value">${templatesData.viewTemplates}</span>
                        </div>
                        <div class="template-stat">
                            <span class="stat-label">Unused Templates</span>
                            <span class="stat-value">${templatesData.unusedViewTemplates}</span>
                        </div>
                        <div class="template-stat">
                            <span class="stat-label">Total Filters</span>
                            <span class="stat-value">${templatesData.filters}</span>
                        </div>
                        <div class="template-stat">
                            <span class="stat-label">Unused Filters</span>
                            <span class="stat-value">${templatesData.unusedFilters}</span>
                        </div>
                    </div>
                `;
            }
            
            updatePerformanceMetrics() {
                const performanceMetricsEl = document.getElementById('performanceMetrics');
                if (!performanceMetricsEl) return;
                
                // Calculate performance metrics
                const totalExecutionTime = this.filteredData.reduce((sum, item) => sum + (item.executionTime || 0), 0);
                const avgExecutionTime = totalExecutionTime / this.filteredData.length;
                const totalElements = this.filteredData.reduce((sum, item) => sum + (item.totalElements || 0), 0);
                const totalWarnings = this.filteredData.reduce((sum, item) => sum + (item.warningCount || 0), 0);
                const totalViews = this.filteredData.reduce((sum, item) => sum + (item.totalViews || 0), 0);
                
                performanceMetricsEl.innerHTML = `
                    <div class="performance-stats">
                        <div class="performance-stat">
                            <span class="stat-label">Total Execution Time</span>
                            <span class="stat-value">${totalExecutionTime.toFixed(2)}s</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Average Execution Time</span>
                            <span class="stat-value">${avgExecutionTime.toFixed(2)}s</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Elements per Second</span>
                            <span class="stat-value">${(totalElements / totalExecutionTime).toFixed(0)}</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Warning Rate</span>
                            <span class="stat-value">${((totalWarnings / totalElements) * 100).toFixed(2)}%</span>
                        </div>
                        <div class="performance-stat">
                            <span class="stat-label">Views per Model</span>
                            <span class="stat-value">${(totalViews / this.filteredData.length).toFixed(1)}</span>
                        </div>
                    </div>
                `;
            }
            
            exportToCSV() {
                const headers = ['Hub', 'Project', 'Model', 'Date', 'Elements', 'Views', 'Warnings', 'Execution Time'];
                const csvContent = [
                    headers.join(','),
                    ...this.filteredData.map(item => [
                        item.hubName,
                        item.projectName,
                        item.modelName,
                        item.timestamp.toLocaleDateString(),
                        item.totalElements,
                        item.totalViews,
                        item.warningCount,
                        item.executionTime
                    ].join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'healthmetric_data.csv';
                a.click();
                window.URL.revokeObjectURL(url);
            }
            
            showLoading() {
                const overlay = document.getElementById('loadingOverlay');
                overlay.style.display = 'flex';
                overlay.classList.remove('hidden');
            }
            
            hideLoading() {
                const overlay = document.getElementById('loadingOverlay');
                overlay.style.display = 'none';
                overlay.classList.add('hidden');
            }
            
            showError(message) {
                const overlay = document.getElementById('loadingOverlay');
                const loadingText = overlay.querySelector('.loading-text');
                loadingText.textContent = message;
                loadingText.style.color = '#ff6b6b';
            }
        }
        
        // Global navigation function
        function navigateToHero() {
            console.log('üîÑ Global navigation to hero page');
            try {
                window.location.href = 'index.html';
            } catch (error) {
                console.error('‚ùå Navigation failed:', error);
                window.history.back();
            }
        }

        // Initialize dashboard when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            try {
                new DashboardApp();
            } catch (error) {
                console.error('Failed to initialize dashboard:', error);
                // Hide loading screen as fallback
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.style.display = 'none';
                }
            }
        });
        
        // Fallback: Hide loading screen after 5 seconds regardless
        setTimeout(() => {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay && overlay.style.display !== 'none') {
                overlay.style.display = 'none';
                console.log('Loading screen hidden by fallback timeout');
            }
        }, 5000);
    </script>
</body>
</html>
